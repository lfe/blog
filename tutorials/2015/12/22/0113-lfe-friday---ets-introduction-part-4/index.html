

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      LFE Blog
      
         - LFE Friday - ETS Introduction, part 4: ETS Access Protections
      
    </title>
    <meta name="description" content="">
    <meta name="author" content="LFEuminati | Alien Alliance">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="/assets/themes/lfe/css/reset.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/assets/themes/lfe/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/lfe/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/css/twilight.css" rel="stylesheet" type="text/css" media="all">

    <link href="/assets/themes/lfe/css/lfetheme.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/assets/css/overrides.css" rel="stylesheet" type="text/css" media="all">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="LFE News & Updates Atom Feed">
  </head>
  <body class="overview">
    <div id="header-wrapper">
      <div id="header">
        <div>
          <a class="logo" href="/">LFE Blog</a>
          <ul class="nav">
            <li><a href="/archive.html" class="nav-api">Archives</a></li>
            <li><a href="/categories.html" class="nav-developers">Categories</a></li>
            <li><a href="/tags.html" class="nav-developers">Tags</a></li>
            <li><a href="/authors.html">Authors</a></li>
            <li class="divider">|</li>
            <li><a href="http://plan.lfe.io/">.plan</a></li>
            <li><a href="http://docs.lfe.io/">docs.lfe.io</a></li>
            <li><a href="http://lfe.io/">lfe.io</a></li>
          </ul>
        </div>
      </div><!-- #header -->
    </div><!-- #header-wrapper -->

    

<div class="wrapper">
  <div class="container">
    <div class="content">
      
      <div class="page-header">
        <h1>
          LFE Friday - ETS Introduction, part 4: ETS Access Protections
          
        </h1>
      </div>

      <div class="row">
        <div class="span8">
          
<p><a href="/assets/images/posts/LispFlavoredErlang-medium-square.png"><img class="left tiny" src="/assets/images/posts/LispFlavoredErlang-medium-square.png" /></a>This week's LFE Friday was translated with permission from the
<a href="http://www.proctor-it.com/category/erlang/erlang-thursday/">Erlang Thursday</a>
series by <a href="https://twitter.com/stevenproctor">Steven Proctor</a>.
<em>This week's translator</em>: Robert Virding.</p>

<p>Today's LFE Friday continues the introduction to ETS and takes a look at the different access levels that ETS supports.</p>

<p>The different access levels that ETS supports are: <code>public</code>, <code>protected</code>, and <code>private</code>.</p>

<p>Each of these different types can be passed in when creating a new ETS table, but let's see what type of ETS table we get when we don't specify an access level.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">table</span> <span class="p">(</span><span class="nv">ets:new</span> <span class="ss">&#39;some-name</span> <span class="p">()))</span>
<span class="mi">8207</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:info</span> <span class="nv">table</span><span class="p">)</span>
<span class="p">(</span><span class="o">#(</span><span class="nv">read_concurrency</span> <span class="nv">false</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">write_concurrency</span> <span class="nv">false</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">compressed</span> <span class="nv">false</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">memory</span> <span class="mi">305</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">owner</span> <span class="nv">&lt;0.28.0&gt;</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">heir</span> <span class="nv">none</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">name</span> <span class="nv">some-name</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">size</span> <span class="mi">0</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">node</span> <span class="nv">nonode@nohost</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">named_table</span> <span class="nv">false</span><span class="p">)</span>
 <span class="o">#(</span><span class="k">type</span> <span class="nb">set</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">keypos</span> <span class="mi">1</span><span class="p">)</span>
 <span class="o">#(</span><span class="nv">protection</span> <span class="nv">protected</span><span class="p">))</span></code></pre></div>

<p>So the default access level is <code>protected</code> when not specified.</p>

<p>So what does it mean for a ETS table to be <code>protected</code> then?  The documentation states that <code>protected</code> tables can be written to by only the owning process, but read by other processes.</p>

<p>So let's see that at work then.</p>

<p>First let's create a process that we can give ETS tables away to.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">fun</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">receive</span> <span class="p">(</span><span class="nv">after</span> <span class="ss">&#39;infinity</span> <span class="ss">&#39;ok</span><span class="p">))))</span>
<span class="err">#</span><span class="nv">Fun&lt;lfe_eval.23.88887576&gt;</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">some-process</span> <span class="p">(</span><span class="nv">spawn</span> <span class="nv">fun</span><span class="p">))</span>
<span class="nv">&lt;0.36.0&gt;</span></code></pre></div>

<p>We create a new ETS table and specify it is <code>protected</code>, and we also specify that it is a <code>named_table</code> as a bonus.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:new</span> <span class="ss">&#39;protected-named-ets</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">protected</span> <span class="nv">named_table</span><span class="p">))</span>
<span class="nv">protected-named-ets</span></code></pre></div>

<p>The result of that evaluation is <code>protected-named-ets</code> and not a number like the call to <code>ets:new/2</code> above, so we should be able to use the name of the table to access the table instead of just the identifier.</p>

<p>We will insert an entry into the ETS table, and we will use the name of the ETS table as the ETS table reference since we said the table is a <code>named_table</code>.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:insert</span> <span class="ss">&#39;protected-named-ets</span> <span class="o">#(</span><span class="nv">foobar</span> <span class="nv">baz</span><span class="p">))</span>
<span class="nv">true</span></code></pre></div>

<p><code>ets:insert/2</code> returned <code>true</code> so we should now have some data in the table.  Let's pull it out using <code>ets:match/2</code>, and let's match everything while we are at it by using a <code>$1</code> for the pattern.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:match</span> <span class="ss">&#39;protected-named-ets</span> <span class="ss">&#39;$1</span><span class="p">)</span>
<span class="p">((</span><span class="o">#(</span><span class="nv">foobar</span> <span class="nv">baz</span><span class="p">)))</span></code></pre></div>

<p>So as the owner process of the ETS table, since this was the process that created it, we can read an write to the table.</p>

<p>Now time to give our table away.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:give_away</span> <span class="ss">&#39;protected-named-ets</span> <span class="nv">some-process</span> <span class="p">())</span>
<span class="nv">true</span></code></pre></div>

<p>Since the documentation says is is available for reads, we will do the same <code>match</code> we just did before giving it away.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:match</span> <span class="ss">&#39;protected-named-ets</span> <span class="ss">&#39;$1</span><span class="p">)</span>
<span class="p">((</span><span class="o">#(</span><span class="nv">foobar</span> <span class="nv">baz</span><span class="p">)))</span></code></pre></div>

<p>We get our results back.</p>

<p>What does a write look like then, since it says only the owning process has access to write, and the return value of calling <code>ets:insert/2</code> is always <code>true</code>.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:insert</span> <span class="ss">&#39;protected-named-ets</span> <span class="o">#(</span><span class="nv">barbaz</span> <span class="nv">foo</span><span class="p">))</span>
<span class="nv">exception</span> <span class="nv">error:</span> <span class="nv">badarg</span>
  <span class="nv">in</span> <span class="p">(</span><span class="err">:</span> <span class="nv">ets</span> <span class="nv">insert</span> <span class="nv">protected-named-ets</span> <span class="o">#(</span><span class="nv">barbaz</span> <span class="nv">foo</span><span class="p">))</span></code></pre></div>

<p>An exception, and it is of type <code>badarg</code>, which does hold that it doesn't allow writes from non-owning processes, but doesn't exactly make it clear that is what is happening.</p>

<p>How about if we see what we get if we try to call <code>ets:insert/2</code> on a table that doesn't exist?</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:insert</span> <span class="ss">&#39;no-such-table</span> <span class="o">#(</span><span class="nv">foo</span> <span class="nv">bar</span><span class="p">))</span>
<span class="nv">exception</span> <span class="nv">error:</span> <span class="nv">badarg</span>
  <span class="nv">in</span> <span class="p">(</span><span class="err">:</span> <span class="nv">ets</span> <span class="nv">insert</span> <span class="nv">no-such-table</span> <span class="o">#(</span><span class="nv">foo</span> <span class="nv">bar</span><span class="p">))</span></code></pre></div>

<p>Same exception and same format of the error with just the name of the table and the tuple being different.</p>

<p>Thinking about this some, it does make sense that these two difference cases would be the same error.  As far as the inserting process knows, there is no such table when trying to do an insert if no table exists, or if it is set to be <code>protected</code>.  Either way, the caller passed in a bad ETS table reference for the call to <code>ets:insert/2</code>.</p>

<p>So we have now seen how <code>protected</code> behaves, which is the default access level, so let's take a look at <code>public</code> next.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="p">(</span><span class="nv">ets:new</span> <span class="ss">&#39;public-named-ets</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">public</span> <span class="nv">named_table</span><span class="p">))</span>
<span class="nv">public-named-ets</span></code></pre></div>

<p>We will do an insert and a match from our current process, which is the owner.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:insert</span> <span class="ss">&#39;public-named-ets</span> <span class="o">#(</span><span class="nv">foo</span> <span class="nv">bar</span><span class="p">))</span>
<span class="nv">true</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:match</span> <span class="ss">&#39;public-named-ets</span> <span class="ss">&#39;$1</span><span class="p">)</span>
<span class="p">((</span><span class="o">#(</span><span class="nv">foo</span> <span class="nv">bar</span><span class="p">)))</span></code></pre></div>

<p>All looks good there.</p>

<p>The documentation states that <code>public</code> allows any process to read from and write to the table, so let's give the public table away to <code>some-process</code> and try to read and write.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:give_away</span> <span class="ss">&#39;public-named-ets</span> <span class="nv">some-process</span> <span class="p">())</span>
<span class="nv">true</span></code></pre></div>

<p>Now that we have given it away, time to try to add a new entry to the table, and see if we can read that write back out.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:insert</span> <span class="ss">&#39;public-named-ets</span> <span class="o">#(</span><span class="nv">bar</span> <span class="nv">baz</span><span class="p">))</span>
<span class="nv">true</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:match</span> <span class="ss">&#39;public-named-ets</span> <span class="ss">&#39;$1</span><span class="p">)</span>
<span class="p">((</span><span class="o">#(</span><span class="nv">foo</span> <span class="nv">bar</span><span class="p">))</span> <span class="p">(</span><span class="o">#(</span><span class="nv">bar</span> <span class="nv">baz</span><span class="p">)))</span></code></pre></div>

<p>There we go.  We have just inserted new data into that table, and when we do the <code>ets:match/2</code> on everything, we see the new data in the result.</p>

<p>Now let's create a <code>private</code> table.  The documentation states that for <code>private</code> ETS tables, only the owner is allowed to read or write to the ETS table.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:new</span> <span class="ss">&#39;private-named-ets</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">private</span> <span class="nv">named_table</span><span class="p">))</span>
<span class="nv">private-named-ets</span></code></pre></div>

<p>Again, while this process still owns the table, we will add an item and do a read from the table.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:insert</span> <span class="ss">&#39;private-named-ets</span> <span class="o">#(</span><span class="nv">fizz</span> <span class="nv">buzz</span><span class="p">))</span>
<span class="nv">true</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:match</span> <span class="ss">&#39;private-named-ets</span> <span class="ss">&#39;$1</span><span class="p">)</span>
<span class="p">((</span><span class="o">#(</span><span class="nv">fizz</span> <span class="nv">buzz</span><span class="p">)))</span></code></pre></div>

<p>Time to give this table away to <code>some-process</code> again.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:give_away</span> <span class="ss">&#39;private-named-ets</span> <span class="nv">some-process</span> <span class="p">())</span>
<span class="nv">true</span></code></pre></div>

<p>Now that the ETS table is owned by a different process, time to try a read.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:match</span> <span class="ss">&#39;private-named-ets</span> <span class="ss">&#39;$1</span><span class="p">)</span>
<span class="nv">exception</span> <span class="nv">error:</span> <span class="nv">badarg</span>
  <span class="nv">in</span> <span class="p">(</span><span class="err">:</span> <span class="nv">ets</span> <span class="nv">match</span> <span class="nv">private-named-ets</span> <span class="nv">$1</span><span class="p">)</span></code></pre></div>

<p><code>badarg</code> exception, just like the attempted <code>ets:insert/2</code> we tried on the protected ETS table above when it was owned by a different process.</p>

<p>And time for a write.</p>

<div class="highlight"><pre><code class="language-lisp"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">ets:insert</span> <span class="ss">&#39;private-named-ets</span> <span class="o">#(</span><span class="nv">buzz</span> <span class="nv">fizz</span><span class="p">))</span> <span class="o">&#39;</span><span class="err">#</span><span class="p">))</span>
<span class="nv">exception</span> <span class="nv">error:</span> <span class="nv">badarg</span>
  <span class="nv">in</span> <span class="p">(</span><span class="err">:</span> <span class="nv">ets</span> <span class="nv">insert</span> <span class="nv">private-named-ets</span> <span class="o">#(</span><span class="nv">buzz</span> <span class="nv">fizz</span><span class="p">))</span></code></pre></div>

<p>A <code>badarg</code> exception here as well, which should not be a surprise at this point, as both the protected write, and this private read both raised that same exception.</p>

<p>So in total, for this introduction so far, we have seen the Type, Access, Named Table, Heir, and Owner settings of an ETS table, and how they relate.</p>

<p>Next week, we will conclude the introduction of ETS by going over the <strong>Key Position</strong> option and the <strong>Tweaks</strong> that an ETS table can take when being setup.</p>

<p>- Proctor, Robert</p>

          <hr>
          <div class="pagination btn-group">
            
            <a class="btn prev" href="/tutorials/2015/12/12/1716-lfe-friday---ets-introduction-part-3" title="LFE Friday - ETS Introduction, part 3: ETS Table Types">&larr; Previous</a>
            
            <a class="btn" href="/archive.html">Archive</a>
            
            <a class="btn next" href="/tutorials/2015/12/25/2138-lfe-friday---ets-introduction-part-5" title="LFE Friday - ETS Introduction, part 5: keypos, read_concurrency and write_concurrency">Next &rarr;</a>
            
          </div>
          <hr>
          
        </div>

        <div class="span4">
          <section>
            <h4>Author</h4>
            <div class="author"><span><a href="/authors.html#Robert Virding">Robert Virding</a></span></div>
          </section>
          <section>
            <h4>Published</h4>
            <div class="date"><span>22 December 2015</span></div>
          </section>
          
          <section>
            <h4>Category</h4>
            <span class="category">
              tutorials
            </span>
          </section>
          
          
          <section>
            <h4>Tags</h4>
            <ul class="tag_box">
              
              


  
     
    	<li><a href="/tags.html#lfe friday-ref">lfe friday <span>58</span></a></li>
     
    	<li><a href="/tags.html#lfe-ref">lfe <span>63</span></a></li>
     
    	<li><a href="/tags.html#erlang-ref">erlang <span>71</span></a></li>
    
  



            </ul>
          </section>
          
        </div>
      </div>


    </div>
  </div> <!-- /container -->
</div>




    <div id="footer" >
    <div class="lower_footer">
      <ul class="footer-cell">
        <li><a href="/archive.html">Archives</a></li>
        <li><a href="/categories.html">Categories</a></li>
        <li><a href="/tags.html">Tags</a></li>
        <li><a href="/authors.html">Authors</a></li>
        <li><a href="/pages.html">Pages</a></li>
      </ul>

      <span class="footer-cell">
        <a href="/"><img src="/assets/themes/lfe/images/logo-white.png"/></a>
      </span>

      <ul class="footer-cell">
        <li><a href="http://github.com/lfex">lfex</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/lisp-flavoured-erlang">List</a></li>
        <li><a href="http://webchat.freenode.net/?channels=erlang-lisp">IRC</a></li>
        <li><a href="http://feeds.feedburner.com/lfe/news-and-updates">RSS</a></li>
        <li><a href="http://twitter.com/ErlangLisp">Twitter</a></li>
        <li><a href="http://github.com/rvirding/lfe">Github</a></li>
      </ul>
    </div>

    <div class="wrapper">
      <p>Original Design &copy; <span class="js-year"></span> GitHub, Inc.</p>
      <p>LFE Design and Content &copy; <span class="js-year"></span> LFEuminati | Alien Alliance</p>
    </div>

  </div><!-- /#footer -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/lfe/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/lfe/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-38274766-2', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>

