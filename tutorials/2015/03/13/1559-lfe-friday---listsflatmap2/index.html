

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      LFE Blog
      
         - LFE Friday - lists:flatmap/2
      
    </title>
    <meta name="description" content="">
    <meta name="author" content="LFEuminati | Alien Alliance">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="/assets/themes/lfe/css/reset.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/assets/themes/lfe/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/lfe/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/css/twilight.css" rel="stylesheet" type="text/css" media="all">

    <link href="/assets/themes/lfe/css/lfetheme.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/assets/css/overrides.css" rel="stylesheet" type="text/css" media="all">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="LFE News & Updates Atom Feed">
  </head>
  <body class="overview">
    <div id="header-wrapper">
      <div id="header">
        <div>
          <a class="logo" href="/">LFE Blog</a>
          <ul class="nav">
            <li><a href="/archive.html" class="nav-api">Archives</a></li>
            <li><a href="/categories.html" class="nav-developers">Categories</a></li>
            <li><a href="/tags.html" class="nav-developers">Tags</a></li>
            <li><a href="/authors.html">Authors</a></li>
            <li class="divider">|</li>
            <li><a href="http://plan.lfe.io/">.plan</a></li>
            <li><a href="http://docs.lfe.io/">docs.lfe.io</a></li>
            <li><a href="http://lfe.io/">lfe.io</a></li>
          </ul>
        </div>
      </div><!-- #header -->
    </div><!-- #header-wrapper -->

    

<div class="wrapper">
  <div class="container">
    <div class="content">
      
      <div class="page-header">
        <h1>
          LFE Friday - lists:flatmap/2
          
        </h1>
      </div>

      <div class="row">
        <div class="span8">
          
<p><a href="/assets/images/posts/LispFlavoredErlang-medium-square.png"><img class="left tiny" src="/assets/images/posts/LispFlavoredErlang-medium-square.png" /></a>This week's LFE Friday was translated with permission from the
<a href="http://www.proctor-it.com/category/erlang/erlang-thursday/">Erlang Thursday</a>
series by <a href="https://twitter.com/stevenproctor">Steven Proctor</a>.
<em>This week's translator</em>: Robert Virding.</p>

<p>Today's LFE Friday is about <a href="http://www.erlang.org/doc/man/lists.html#flatmap-2">lists:flatmap/2</a>.</p>

<p>The trick with <code>lists:flatmap/2</code> is working it out what it does, or rather what it does <strong>not</strong> do. For example it does not take a list of items that are nested arbitrarily deep, and map over the flattened list in the equivalent of this:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lists:map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nv">lists:flatten</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="p">((</span><span class="mi">2</span> <span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="mi">4</span><span class="p">))))</span>   
<span class="p">(</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">16</span><span class="p">)</span></code></pre></div>

<p>In the Erlang docs we see that <code>lists:flatmap/2</code> takes a function that takes an item of type <code>A</code> and returns a list of items that are of type <code>B</code>, and that the second argument to <code>lists:flatmap/2</code> was a list of items of type <code>A</code>. What this means is best described in the docs by that it behaves as if defined by:</p>

<div class="highlight"><pre><code class="language-cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">flatmap</span> <span class="p">(</span><span class="nv">fun</span> <span class="nb">list</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">fun</span> <span class="nb">list</span><span class="p">)))</span></code></pre></div>

<p>It does the map first and then does the flatten but only one level deep.</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lists:flatmap</span> <span class="p">(</span><span class="nv">match-lambda</span> <span class="p">((</span><span class="o">`#(,</span><span class="nv">item</span> <span class="o">,</span><span class="nb">count</span><span class="p">))</span>
                                <span class="p">(</span><span class="nv">lists:duplicate</span> <span class="nb">count</span> <span class="nv">item</span><span class="p">)))</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="o">#(</span><span class="nv">a</span> <span class="mi">1</span><span class="p">)</span> <span class="o">#(</span><span class="nv">b</span> <span class="mi">2</span><span class="p">)</span> <span class="o">#(</span><span class="nv">C</span> <span class="mi">3</span><span class="p">)</span> <span class="o">#(</span><span class="nv">_d_</span> <span class="mi">4</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">b</span> <span class="nv">C</span> <span class="nv">C</span> <span class="nv">C</span> <span class="nv">_d_</span> <span class="nv">_d_</span> <span class="nv">_d_</span> <span class="nv">_d_</span><span class="p">)</span></code></pre></div>
<p>And if we pass those values to the "equivalent" behavior of calling map and then calling append on the list returned from map, we see the results are the same.</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lists:append</span> <span class="p">(</span><span class="nv">lists:map</span> <span class="p">(</span><span class="nv">match-lambda</span> <span class="p">((</span><span class="o">`#(,</span><span class="nv">item</span> <span class="o">,</span><span class="nb">count</span><span class="p">))</span>
                                          <span class="p">(</span><span class="nv">lists:duplicate</span> <span class="nb">count</span> <span class="nv">item</span><span class="p">)))</span>
                <span class="o">&#39;</span><span class="p">(</span><span class="o">#(</span><span class="nv">a</span> <span class="mi">1</span><span class="p">)</span> <span class="o">#(</span><span class="nv">b</span> <span class="mi">2</span><span class="p">)</span> <span class="o">#(</span><span class="nv">C</span> <span class="mi">3</span><span class="p">)</span> <span class="o">#(</span><span class="nv">_d_</span> <span class="mi">4</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">b</span> <span class="nv">C</span> <span class="nv">C</span> <span class="nv">C</span> <span class="nv">_d_</span> <span class="nv">_d_</span> <span class="nv">_d_</span> <span class="nv">_d_</span><span class="p">)</span></code></pre></div>

<p>And to further clarify, <code>lists:flatmap/2</code> doesnâ€™t even do a flatten on the resulting list, but simply adjoins the lists that were returned from the mapping function. This can be seen below, as we can see there is still an nested list structure in the results, and the resulting list is not only one level deep.</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lists:flatmap</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">x</span><span class="p">)))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">))</span>
<span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">a</span><span class="p">)</span> <span class="nv">b</span> <span class="p">(</span><span class="nv">b</span><span class="p">)</span> <span class="nv">c</span> <span class="p">(</span><span class="nv">c</span><span class="p">)</span> <span class="nv">d</span> <span class="p">(</span><span class="nv">d</span><span class="p">))</span></code></pre></div>

<p>I hope this can save some confusion.</p>

<p>-Proctor, Robert</p>

          <hr>
          <div class="pagination btn-group">
            
            <a class="btn prev" href="/tutorials/2015/03/06/0152-lfe-friday---calendarlocal_time_to_universal_time_dst1" title="LFE Friday - calendar:local_time_to_universal_time_dst/1">&larr; Previous</a>
            
            <a class="btn" href="/archive.html">Archive</a>
            
            <a class="btn next" href="/formalwear/2015/03/20/1256-new-lfe-t-shirt" title="New LFE T-Shirt">Next &rarr;</a>
            
          </div>
          <hr>
          
        </div>

        <div class="span4">
          <section>
            <h4>Author</h4>
            <div class="author"><span><a href="/authors.html#Robert Virding">Robert Virding</a></span></div>
          </section>
          <section>
            <h4>Published</h4>
            <div class="date"><span>13 March 2015</span></div>
          </section>
          
          <section>
            <h4>Category</h4>
            <span class="category">
              tutorials
            </span>
          </section>
          
          
          <section>
            <h4>Tags</h4>
            <ul class="tag_box">
              
              


  
     
    	<li><a href="/tags.html#lfe friday-ref">lfe friday <span>58</span></a></li>
     
    	<li><a href="/tags.html#lfe-ref">lfe <span>63</span></a></li>
     
    	<li><a href="/tags.html#erlang-ref">erlang <span>71</span></a></li>
    
  



            </ul>
          </section>
          
        </div>
      </div>


    </div>
  </div> <!-- /container -->
</div>




    <div id="footer" >
    <div class="lower_footer">
      <ul class="footer-cell">
        <li><a href="/archive.html">Archives</a></li>
        <li><a href="/categories.html">Categories</a></li>
        <li><a href="/tags.html">Tags</a></li>
        <li><a href="/authors.html">Authors</a></li>
        <li><a href="/pages.html">Pages</a></li>
      </ul>

      <span class="footer-cell">
        <a href="/"><img src="/assets/themes/lfe/images/logo-white.png"/></a>
      </span>

      <ul class="footer-cell">
        <li><a href="http://github.com/lfex">lfex</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/lisp-flavoured-erlang">List</a></li>
        <li><a href="http://webchat.freenode.net/?channels=erlang-lisp">IRC</a></li>
        <li><a href="http://feeds.feedburner.com/lfe/news-and-updates">RSS</a></li>
        <li><a href="http://twitter.com/ErlangLisp">Twitter</a></li>
        <li><a href="http://github.com/rvirding/lfe">Github</a></li>
      </ul>
    </div>

    <div class="wrapper">
      <p>Original Design &copy; <span class="js-year"></span> GitHub, Inc.</p>
      <p>LFE Design and Content &copy; <span class="js-year"></span> LFEuminati | Alien Alliance</p>
    </div>

  </div><!-- /#footer -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/lfe/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/lfe/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-38274766-2', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>

