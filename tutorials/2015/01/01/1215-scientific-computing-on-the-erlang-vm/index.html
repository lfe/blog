

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      LFE Blog
      
         - Scientific Computing on the Erlang VM
      
    </title>
    <meta name="description" content="Polynomial Curve Fitting with LFE">
    <meta name="author" content="LFEuminati | Alien Alliance">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="/assets/themes/lfe/css/reset.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/assets/themes/lfe/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/lfe/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/css/twilight.css" rel="stylesheet" type="text/css" media="all">

    <link href="/assets/themes/lfe/css/lfetheme.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/assets/css/overrides.css" rel="stylesheet" type="text/css" media="all">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="LFE News & Updates Atom Feed">
  </head>
  <body class="overview">
    <div id="header-wrapper">
      <div id="header">
        <div>
          <a class="logo" href="/">LFE Blog</a>
          <ul class="nav">
            <li><a href="/archive.html" class="nav-api">Archives</a></li>
            <li><a href="/categories.html" class="nav-developers">Categories</a></li>
            <li><a href="/tags.html" class="nav-developers">Tags</a></li>
            <li><a href="/authors.html">Authors</a></li>
            <li class="divider">|</li>
            <li><a href="http://plan.lfe.io/">.plan</a></li>
            <li><a href="http://docs.lfe.io/">docs.lfe.io</a></li>
            <li><a href="http://lfe.io/">lfe.io</a></li>
          </ul>
        </div>
      </div><!-- #header -->
    </div><!-- #header-wrapper -->

    

<div class="wrapper">
  <div class="container">
    <div class="content">
      
      <div class="page-header">
        <h1>
          Scientific Computing on the Erlang VM
          
        </h1>
      </div>

      <div class="row">
        <div class="span8">
          
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<p><a href="/assets/images/posts/lsci-erlang-ecosystem.png"><img class="right thumb" src="/assets/images/posts/lsci-erlang-ecosystem.png" /></a>This tutorial brings in the New Year by introducing the Erlang/LFE
scientific computing library <a href="https://github.com/lfex/lsci">lsci</a>
â€“ a ports wrapper of NumPy and SciPy (among others) for the Erlang ecosystem.
The topic of the tutorial is polynomial curve-fitting for a given data set.
Additionally, this post further demonstrates <a href="https://github.com/lfex/py/">py</a>
usage, the
<a href="http://localhost:4000/announcements/2014/12/27/1641-easy-python-from-lfeerlang">previously discussed</a>
Erlang/LFE library for running Python code from the Erlang VM.</p>

<h2 id="background">Background</h2>

<p>The content of this post was taken from a
<a href="http://technicae.cogitat.io/2014/11/scientific-computing-with-hy.html">similar tutorial</a>
done by the same author for the Python Lisp <a href="http://hylang.org/">Hy</a> in an
<a href="http://nbviewer.ipython.org/github/oubiwann/linear-regression-tutorial/blob/master/notebooks/tutorial.ipynb">IPython notebook</a>.
It, in turn, was completely inspired by the
<a href="http://data-sorcery.org/2009/06/04/linear-regression-with-higher-order-terms/">Clojure Incanter tutorial</a>
on the same subject, by David Edgar Liebke.</p>

<p>This content is also available in the
<a href="https://github.com/lfex/lsci/tree/cbba7e4705bdc8baaa8b8abaf40ae1649ed44b42/examples/polyfit">lsci examples directory</a>.</p>

<h2 id="introduction">Introduction</h2>

<p>The lsci library (pronounced "Elsie") provides access to the fast numerical
processing libraries that have become so popular in the scientific computing
community. lsci is written in LFE but can be used just as easily from Erlang.</p>

<p>lsci provides the following set of features:</p>

<ul>
  <li>Wrapper functions (many generated dynamically via macros) for:
    <ul>
      <li>The Python 3 standard library module <a href="https://docs.python.org/3/library/math.html">math</a></li>
      <li>The Python 3 standard library module <a href="https://docs.python.org/3/library/cmath.html">cmath</a></li>
      <li>The Python 3 standard library module <a href="https://docs.python.org/3/library/statistics.html">statistics</a></li>
      <li><a href="http://www.numpy.org/">NumPy</a></li>
      <li><a href="http://www.scipy.org/scipylib/index.html">SciPy</a></li>
      <li>Planned support for
<a href="https://docs.python.org/3/library/fractions.html">fractions</a>,
<a href="https://docs.python.org/3/library/decimal.html">decimal</a>,
<a href="http://pandas.pydata.org/">Pandas</a>,
<a href="http://matplotlib.org/">matplotlib</a>, and
<a href="http://www.sympy.org/en/index.html">SymPy</a></li>
    </ul>
  </li>
  <li>The <a href="https://github.com/lfex/py/">py</a> wrappers for
<a href="http://erlport.org/">ErlPort</a> which make calling Python
module-level functions, object attributes and methods, constructors,
function objects, etc., very easy</li>
  <li>Custom encoders/decoders for some of the wrapped data types</li>
</ul>

<p>lsci is brand-new, and thus has far to go before it completely wraps all the
functionality in NumPy, SciPy, etc. However, enough of it is done that one can
perform tasks like polynomial curve-fitting and statistical regression.</p>

<h2 id="setup">Setup</h2>

<p>To run this tutorial, you will need the following on your system:</p>

<ul>
  <li>Erlang (tested with 17.3)</li>
  <li>rebar</li>
  <li>lfetool</li>
  <li>Python 3</li>
  <li>git</li>
</ul>

<p>With those in place, let's get you ready:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nv">$</span> <span class="nv">git</span> <span class="nv">clone</span> <span class="nv">git@github.com:lfex/lsci.git</span>
<span class="nv">$</span> <span class="nv">cd</span> <span class="nv">lsci</span>
<span class="nv">$</span> <span class="nv">make</span>
<span class="nv">$</span> <span class="o">.</span> <span class="o">.</span><span class="nv">/python/.venv/bin/activate</span></code></pre></div>

<p>That will download all the Erlang and Python dependencies, compile the Erlang
libs, and set up a Python virtualenv in your working directory. If you are
not familiar with Python, the last command is what allows one to actually
use the Python virtualenv, with all the libraries you just downloaded.</p>

<p>You are now ready for the LFE REPL:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nv">$</span> <span class="nv">make</span> <span class="nv">repl-no-deps</span></code></pre></div>

<h2 id="loading-data">Loading Data</h2>

<p>The "observed data" we're going to use is the same data set as
that used in the
<a href="http://data-sorcery.org/2009/06/04/linear-regression-with-higher-order-terms/">Incanter linear regression tutorial</a>,
the
<a href="http://www.itl.nist.gov/div898/strd/lls/data/LINKS/DATA/Filip.dat">NIST Filip.dat</a>
file. The data file we will use is a conversion of the original NIST file to
CSV.</p>

<p>Let's load our experimental data:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">data</span> <span class="p">(</span><span class="nv">lsci-np:genfromtxt</span>
              <span class="s">&quot;examples/polyfit/filip.csv&quot;</span>
              <span class="o">`</span><span class="p">(</span><span class="o">#(</span><span class="nv">delimiter</span> <span class="o">,</span><span class="p">(</span><span class="nv">list_to_binary</span> <span class="s">&quot;,&quot;</span><span class="p">))</span>
                <span class="o">#(</span><span class="nv">names</span> <span class="nv">true</span><span class="p">))))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span>
  <span class="err">#</span><span class="nv">B</span><span class="p">(</span><span class="mi">128</span> <span class="mi">2</span> <span class="mi">99</span> <span class="mi">110</span> <span class="mi">117</span> <span class="mi">109</span> <span class="mi">112</span> <span class="mi">121</span> <span class="mi">46</span> <span class="mi">99</span> <span class="mi">111</span> <span class="mi">114</span> <span class="mi">101</span> <span class="mi">46</span> <span class="mi">109</span> <span class="mi">117</span> <span class="mi">108</span> <span class="o">...</span><span class="p">))</span></code></pre></div>

<p>The data returned by this function is an ErlPort binary wrapping a Python
pickle of a NumPy array. We can take a look at the data by converting it to
a list:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">data</span><span class="p">)</span>
<span class="p">(</span><span class="o">#(</span><span class="mf">0.8116</span> <span class="mf">-6.860120914</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9072</span> <span class="mf">-4.324130045</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9052</span> <span class="mf">-4.358625055</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9039</span> <span class="mf">-4.358426747</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8053</span> <span class="mf">-6.955852379</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8377</span> <span class="mf">-6.661145254</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8667</span> <span class="mf">-6.355462942</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8809</span> <span class="mf">-6.118102026</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.7975</span> <span class="mf">-7.115148017</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8162</span> <span class="mf">-6.815308569</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8515</span> <span class="mf">-6.519993057</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8766</span> <span class="mf">-6.204119983</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8885</span> <span class="mf">-5.853871964</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8859</span> <span class="mf">-6.109523091</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8959</span> <span class="mf">-5.79832982</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8913</span> <span class="mf">-5.482672118</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8959</span> <span class="mf">-5.171791386</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8971</span> <span class="mf">-4.851705903</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9021</span> <span class="mf">-4.517126416</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.909</span> <span class="mf">-4.143573228</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9139</span> <span class="mf">-3.709075441</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9199</span> <span class="mf">-3.499489089</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8692</span> <span class="mf">-6.300769497</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8872</span> <span class="mf">-5.953504836</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.89</span> <span class="mf">-5.642065153</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.891</span> <span class="mf">-5.031376979</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.8977</span> <span class="mf">-4.680685696</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9035</span> <span class="mf">-4.329846955</span><span class="p">)</span>
 <span class="o">#(</span><span class="mf">0.9078</span> <span class="o">...</span><span class="p">)</span>
 <span class="o">#(...</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<h2 id="a-note-about-values">A Note about Values</h2>

<p>If you haven't noticed yet, you certainly will as you run through these
examples in the LFE REPL: we keep getting opaque binary data back from NumPy.
Why can't lsci just convert that?</p>

<p>While it would be nice to have that data presented to us in the REPL in such
a way that we could <em>actually tell</em> what is was, this would run counter to the
whole purpose of using libraries like NumPy and SciPy from the Erlang VM in the
first place. It would do several things:</p>

<ul>
  <li>Add latency for each calculation</li>
  <li>Reduce the precision available in the NumPy data types (by being converted
first to Python native types and then to Erlang data types)</li>
  <li>Bring only Erlang-native data types into the REPL, thus requiring us to
create new NumPy data types to pass <em>back</em> to Python if we wanted to benefit
from NumPy's speed, or another way of saying this,</li>
  <li>Make it difficult to pass results back into NumPy for further processing</li>
</ul>

<p>As such, lsci compromises by providing convenience functions for converting
returned results to something we can look at. We will use such functions as
<code>-&gt;list</code> and <code>-&gt;float</code> in the remainder of this tutorial for just that
purpose.</p>

<h2 id="plotting-our-data">Plotting Our Data</h2>

<p>Because our CSV file had headers and we told <code>genfromtxt</code> to use them with the
<code>#(names true)</code> option, we can easily extract the <script type="math/tex">x</script> and <script type="math/tex">y</script> axis data.
Let's look at their values separately:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">xs</span> <span class="p">(</span><span class="nv">lsci-np:get</span> <span class="nv">data</span> <span class="ss">&#39;x</span><span class="p">))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ys</span> <span class="p">(</span><span class="nv">lsci-np:get</span> <span class="nv">data</span> <span class="ss">&#39;y</span><span class="p">))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">xs</span><span class="p">)</span>
<span class="p">(</span><span class="mf">-6.860120914</span> <span class="mf">-4.324130045</span> <span class="mf">-4.358625055</span> <span class="mf">-4.358426747</span> <span class="mf">-6.955852379</span>
 <span class="mf">-6.661145254</span> <span class="mf">-6.355462942</span> <span class="mf">-6.118102026</span> <span class="mf">-7.115148017</span> <span class="mf">-6.815308569</span>
 <span class="mf">-6.519993057</span> <span class="mf">-6.204119983</span> <span class="mf">-5.853871964</span> <span class="mf">-6.109523091</span> <span class="mf">-5.79832982</span>
 <span class="mf">-5.482672118</span> <span class="mf">-5.171791386</span> <span class="mf">-4.851705903</span> <span class="mf">-4.517126416</span> <span class="mf">-4.143573228</span>
 <span class="mf">-3.709075441</span> <span class="mf">-3.499489089</span> <span class="mf">-6.300769497</span> <span class="mf">-5.953504836</span> <span class="mf">-5.642065153</span>
 <span class="mf">-5.031376979</span> <span class="mf">-4.680685696</span> <span class="mf">-4.329846955</span> <span class="mf">-3.928486195</span> <span class="mf">-8.56735134</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">ys</span><span class="p">)</span>
<span class="p">(</span><span class="mf">0.8116</span> <span class="mf">0.9072</span> <span class="mf">0.9052</span> <span class="mf">0.9039</span> <span class="mf">0.8053</span> <span class="mf">0.8377</span> <span class="mf">0.8667</span> <span class="mf">0.8809</span> <span class="mf">0.7975</span>
 <span class="mf">0.8162</span> <span class="mf">0.8515</span> <span class="mf">0.8766</span> <span class="mf">0.8885</span> <span class="mf">0.8859</span> <span class="mf">0.8959</span> <span class="mf">0.8913</span> <span class="mf">0.8959</span> <span class="mf">0.8971</span>
 <span class="mf">0.9021</span> <span class="mf">0.909</span> <span class="mf">0.9139</span> <span class="mf">0.9199</span> <span class="mf">0.8692</span> <span class="mf">0.8872</span> <span class="mf">0.89</span> <span class="mf">0.891</span> <span class="mf">0.8977</span> <span class="mf">0.9035</span>
 <span class="mf">0.9078</span> <span class="mf">0.7675</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<p>Now let's plot our data in the terminal:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-asciiplot:scatter</span> <span class="nv">xs</span> <span class="nv">ys</span><span class="p">)</span></code></pre></div>

<p>Which will give you something like this:</p>

<div class="highlight"><pre><code>                                                                           oo  o o
                                                                      o o
                                                                  o  o   o
                                                               oo
                                                        o o o
                                          o      o o  o o  o
                                        ooo ooo      o
                                     oo o
                                    oooo
                                    oo
                                 ooo
                                  o
                                 o
                               o
                               oo

                             o
                              o
                             o

                           o
                          o o
                         o o

                       oo o
                       o
                     o
                   oo
o           o  ooo
     oooo oo
o oo
o

ok
</code></pre></div>

<h2 id="curve-fitting">Curve Fitting</h2>

<p>The <a href="http://www.itl.nist.gov/div898/strd/lls/data/LINKS/DATA/Filip.dat">NIST data set</a>
provided a polynomial describing this data:</p>

<div class="highlight"><pre><code>y = B0 + B1*x + B2*(x**2) + ... + B9*(x**9) + B10*(x**10) + e
</code></pre></div>

<p>Or, if you prefer LaTeX:</p>

<p>\begin{equation}
y = B_0 + B_1{x} + B_2{x^2} + â€¦ + B_9{x^9} + B_{10}{x^{10}} + e
\end{equation}</p>

<p>Using NumPy, we can easily fit a 10th-degree polynomial curve to this data.
We will use <code>numpy.polyfit</code> for finding a least squares polynomial fit,
passing it the <script type="math/tex">x</script> and <script type="math/tex">y</script> values for the data to fit as well as the degree
of our polynomial:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">coeffs</span> <span class="p">(</span><span class="nv">lsci-np:polyfit</span> <span class="nv">xs</span> <span class="nv">ys</span> <span class="mi">10</span><span class="p">))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<p>Let's peek at the data:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">coeffs</span><span class="p">)</span>
<span class="p">(</span><span class="mf">-4.029625205186532e-5</span> <span class="mf">-0.0024678107546401437</span> <span class="mf">-0.06701911469215643</span>
 <span class="mf">-1.0622149736864719</span> <span class="mf">-10.875317910262362</span> <span class="mf">-75.12420087227511</span>
 <span class="mf">-354.47822960532113</span> <span class="mf">-1127.973927925715</span> <span class="mf">-2316.371054759451</span>
 <span class="mf">-2772.1795597594755</span> <span class="mf">-1467.4895971641686</span><span class="p">)</span></code></pre></div>

<p><code>numpy.polyfit</code> can return more data, if you are so inclined, by passing the
<code>#(full true)</code> option:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="o">`#(,</span><span class="nv">coeffs</span>
          <span class="o">,</span><span class="nv">residuals</span>
          <span class="o">,</span><span class="nv">rank</span>
          <span class="o">,</span><span class="nv">singular-values</span>
          <span class="o">,</span><span class="nv">rcond</span><span class="p">)</span> <span class="p">(</span><span class="nv">lsci-np:polyfit</span> <span class="nv">xs</span> <span class="nv">ys</span> <span class="mi">10</span> <span class="o">&#39;</span><span class="p">(</span><span class="o">#(</span><span class="nv">full</span> <span class="nv">true</span><span class="p">))))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">coeffs</span><span class="p">)</span>
<span class="p">(</span><span class="mf">-4.029625205186532e-5</span> <span class="mf">-0.0024678107546401437</span> <span class="mf">-0.06701911469215643</span>
 <span class="mf">-1.0622149736864719</span> <span class="mf">-10.875317910262362</span> <span class="mf">-75.12420087227511</span>
 <span class="mf">-354.47822960532113</span> <span class="mf">-1127.973927925715</span> <span class="mf">-2316.371054759451</span>
 <span class="mf">-2772.1795597594755</span> <span class="mf">-1467.4895971641686</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">residuals</span><span class="p">)</span>
<span class="p">(</span><span class="mf">7.958513839371895e-4</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="nv">rank</span>
<span class="mi">11</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">singular-values</span><span class="p">)</span>
<span class="p">(</span><span class="mf">3.128894711145785</span> <span class="mf">1.064548669029962</span> <span class="mf">0.27180324022363517</span>
 <span class="mf">0.05296821542551952</span> <span class="mf">0.008387108325776571</span> <span class="mf">0.0010157565988992792</span>
 <span class="mf">9.583030547029836e-5</span> <span class="mf">7.605115790256685e-6</span> <span class="mf">4.6491044714423815e-7</span>
 <span class="mf">1.9871421381342612e-8</span> <span class="mf">6.009222284310632e-10</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">rcond</span><span class="p">)</span>
<span class="mf">1.8207657603852567e-14</span></code></pre></div>

<p>There is a convenience class in NumPy <code>numpy.poly1d</code> that, once instantiated
with our fit data, we can use to evaluate at any given point. Let's try it
out:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">model</span> <span class="p">(</span><span class="nv">lsci-np:poly1d</span> <span class="nv">coeffs</span><span class="p">))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<p>Let's call this function against several values as a sanity check:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="p">(</span><span class="nv">py:func</span> <span class="nv">model</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-9</span><span class="p">)))</span>
<span class="mf">0.7766886098502255</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="p">(</span><span class="nv">py:func</span> <span class="nv">model</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-7</span><span class="p">)))</span>
<span class="mf">0.7990591787051926</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="p">(</span><span class="nv">py:func</span> <span class="nv">model</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-6</span><span class="p">)))</span>
<span class="mf">0.8860483219018533</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="p">(</span><span class="nv">py:func</span> <span class="nv">model</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-5</span><span class="p">)))</span>
<span class="mf">0.8926343904781788</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="p">(</span><span class="nv">py:func</span> <span class="nv">model</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-4</span><span class="p">)))</span>
<span class="mf">0.9094348679923314</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="p">(</span><span class="nv">py:func</span> <span class="nv">model</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-3</span><span class="p">)))</span>
<span class="mf">0.8893022773313533</span></code></pre></div>

<p>By examining our original data set, we can see that these check out just fine.</p>

<h2 id="polynomial-linear-regression">Polynomial Linear Regression</h2>

<p>Next let's see if our linear model matches up with what NIST provided. We're
going to need to calculate the
<a href="http://en.wikipedia.org/wiki/Coefficient_of_determination">coefficient of determination</a>,
or <script type="math/tex">R^2</script> â€“ a value that indicates how well a statistical model fits with
measured data. We'll start by feeding our <script type="math/tex">x</script> values into our model:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">y-predicted</span> <span class="p">(</span><span class="nv">py:func</span> <span class="nv">model</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">xs</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;list</span> <span class="nv">y-predicted</span><span class="p">)</span>
<span class="p">(</span><span class="mf">0.8115567059126079</span> <span class="mf">0.9058214190752096</span> <span class="mf">0.9051532611576931</span>
 <span class="mf">0.9051572417567968</span> <span class="mf">0.8027951904375641</span> <span class="mf">0.8316306323870322</span>
 <span class="mf">0.8619032382121077</span> <span class="mf">0.8798465345066688</span> <span class="mf">0.7904039687107343</span>
 <span class="mf">0.8159121506946576</span> <span class="mf">0.8461646108687546</span> <span class="mf">0.8741409704916805</span>
 <span class="mf">0.8911095569417284</span> <span class="mf">0.880361461470784</span> <span class="mf">0.8923272580695993</span>
 <span class="mf">0.8938414797164569</span> <span class="mf">0.8922115816051246</span> <span class="mf">0.8943421465901338</span>
 <span class="mf">0.9015888194142008</span> <span class="mf">0.908406582014095</span> <span class="mf">0.9117908062162314</span>
 <span class="mf">0.9177642755723809</span> <span class="mf">0.8666215053945052</span> <span class="mf">0.8879651108427424</span>
 <span class="mf">0.8940117353472488</span> <span class="mf">0.8924367760930636</span> <span class="mf">0.897684962889798</span>
 <span class="mf">0.9057141589178173</span> <span class="mf">0.9097792825882607</span> <span class="mf">0.7667388250863496</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<p>We will also need several other values in order to calculate <script type="math/tex">R^2</script>, per the
equation given on the Wikipedia page linked above:</p>

<ul>
  <li>The mean value of our observed (original) data:
<script type="math/tex">\bar{y}=\frac{1}{n}\sum_{i=1}^n y_i</script></li>
  <li>The total sum of squares : <script type="math/tex">SS_\text{tot}=\sum_i (y_i-\bar{y})^2</script></li>
  <li>The regression sum of squares : <script type="math/tex">SS_\text{reg}=\sum_i (f_i -\bar{y})^2</script></li>
  <li>The sum of squares of residuals : <script type="math/tex">SS_\text{res}=\sum_i (y_i - f_i)^2</script></li>
</ul>

<p>We already have the following:</p>

<ul>
  <li><script type="math/tex">y_i</script>: the <script type="math/tex">y</script> values from the observed (NIST) data</li>
  <li><script type="math/tex">f_i</script>: the values generated by our model</li>
</ul>

<p>With these, we will be able to calculate <script type="math/tex">R^2</script>:</p>

<script type="math/tex; mode=display">
\begin{equation}
R^2 \equiv 1 - {SS_{\rm res}\over SS_{\rm tot}}
\end{equation}
</script>

<p>Here are the calculations:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">y-mean</span> <span class="p">(</span><span class="nv">lsci-np:/</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="nv">ys</span><span class="p">)</span> <span class="p">(</span><span class="nv">lsci-np:size</span> <span class="nv">ys</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ss-tot</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="p">(</span><span class="nv">lsci-np:^</span> <span class="p">(</span><span class="nv">lsci-np:-</span> <span class="nv">ys</span> <span class="nv">y-mean</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ss-reg</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="p">(</span><span class="nv">lsci-np:^</span> <span class="p">(</span><span class="nv">lsci-np:-</span> <span class="nv">y-predicted</span> <span class="nv">y-mean</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ss-res</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="p">(</span><span class="nv">lsci-np:^</span> <span class="p">(</span><span class="nv">lsci-np:-</span> <span class="nv">ys</span> <span class="nv">y-predicted</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<p>Instead of <code>(lsci-np:^ ...)</code> you may use <code>(lsci-np:** ...)</code>, if you
prefer, e.g.:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ss-res</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="p">(</span><span class="nv">lsci-np:**</span> <span class="p">(</span><span class="nv">lsci-np:-</span> <span class="nv">ys</span> <span class="nv">y-predicted</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<p>Those use shortened aliases; you may prefer the long form:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">y-mean</span> <span class="p">(</span><span class="nv">lsci-np:divide</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="nv">ys</span><span class="p">)</span> <span class="p">(</span><span class="nv">lsci-np:size</span> <span class="nv">ys</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ss-tot</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="p">(</span><span class="nv">lsci-np:power</span> <span class="p">(</span><span class="nv">lsci-np:subtract</span> <span class="nv">ys</span> <span class="nv">y-mean</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ss-reg</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="p">(</span><span class="nv">lsci-np:power</span> <span class="p">(</span><span class="nv">lsci-np:subtract</span> <span class="nv">y-predicted</span> <span class="nv">y-mean</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ss-res</span> <span class="p">(</span><span class="nv">lsci-np:sum</span> <span class="p">(</span><span class="nv">lsci-np:power</span> <span class="p">(</span><span class="nv">lsci-np:subtract</span> <span class="nv">ys</span> <span class="nv">y-predicted</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span></code></pre></div>

<p>Let's sanity-check the results:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="nv">y-mean</span><span class="p">)</span>
<span class="mf">0.8495756097560976</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="nv">ss-tot</span><span class="p">)</span>
<span class="mf">0.2431874712195122</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="nv">ss-reg</span><span class="p">)</span>
<span class="mf">0.24239162093851477</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="nv">ss-res</span><span class="p">)</span>
<span class="mf">7.958513853880548e-4</span></code></pre></div>

<p>Now we're ready to get the <script type="math/tex">R^2</script> value for our model:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">r-squared</span> <span class="p">(</span><span class="nv">lsci-np:-</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">lsci-np:/</span> <span class="nv">ss-res</span> <span class="nv">ss-tot</span><span class="p">)))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="nv">r-squared</span><span class="p">)</span>
<span class="mf">0.9967274161723995</span></code></pre></div>

<p>If we compare this to the value from the original NIST data file,
<code>0.996727416185620</code>, we see that our model did pretty well:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="p">(</span><span class="nv">lsci-np:-</span> <span class="nv">r-squared</span> <span class="mf">0.996727416185620</span><span class="p">))</span>
<span class="mf">-1.3220535777236364e-11</span></code></pre></div>

<p>That's a pretty tiny difference!</p>

<h2 id="a-linear-model-class">A Linear Model Class</h2>

<p>The linear model code above is a bit cumbersome; it would be much more
convenient for multiple-use if there was a Python class that did all the
arithmetic for us, and we could just get attribute values â€¦ So that's
what we created:</p>

<div class="highlight"><pre><code class="language-python"><span class="k">class</span> <span class="nc">PolynomialLinearModel</span><span class="p">:</span>
    <span class="s">&quot;A convenience class for creating polynomial linear models.&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_y_mean</span><span class="p">()</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys_predicted</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">ss_tot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss_reg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss_res</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">r_squared</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">singular_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcond</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyfit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">polyfit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singular_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rcond</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ys_predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ss_tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ss_tot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ss_reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ss_reg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ss_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ss_res</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_squared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_r_squared</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;coeffs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s">&quot;residuals&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s">&quot;rank&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span>
            <span class="s">&quot;singular-values&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">singular_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s">&quot;rcond&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rcond</span><span class="p">),</span>
            <span class="s">&quot;y-mean&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_mean</span><span class="p">),</span>
            <span class="s">&quot;ss-tot&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ss_tot</span><span class="p">),</span>
            <span class="s">&quot;ss-reg&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ss_reg</span><span class="p">),</span>
            <span class="s">&quot;ss-res&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ss_res</span><span class="p">),</span>
            <span class="s">&quot;r-squared&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_squared</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_y_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">get_ss_tot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_y_mean</span><span class="p">())</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_ss_reg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ys_predicted</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_y_mean</span><span class="p">())</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_ss_res</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys_predicted</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_r_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ss_res</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ss_tot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span></code></pre></div>

<p>This has been saved to the Python module <code>lsci.numpysupl</code> with the
<code>lsci-np</code> wrapper function <code>lsci-np:poly-linear-model</code> added. Now we can
easily create a linear model which provides everything needed in one go:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">model</span> <span class="p">(</span><span class="nv">lsci-np:poly-linear-model</span> <span class="nv">xs</span> <span class="nv">ys</span> <span class="mi">10</span><span class="p">))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">py:ptype</span> <span class="nv">model</span><span class="p">)</span>
<span class="nv">lsci.numpysupl.PolynomialLinearModel</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">py:attr</span> <span class="nv">model</span> <span class="ss">&#39;results</span><span class="p">)</span>
<span class="o">#(</span><span class="s">&quot;dict&quot;</span>
  <span class="p">(</span><span class="o">#(</span><span class="s">&quot;rcond&quot;</span> <span class="mf">1.8207657603852567e-14</span><span class="p">)</span>
   <span class="o">#(</span><span class="s">&quot;rank&quot;</span> <span class="mi">11</span><span class="p">)</span>
   <span class="o">#(</span><span class="s">&quot;coeffs&quot;</span>
     <span class="p">(</span><span class="mf">-4.029625205186532e-5</span> <span class="mf">-0.0024678107546401437</span>
      <span class="mf">-0.06701911469215643</span> <span class="mf">-1.0622149736864719</span> <span class="mf">-10.875317910262362</span>
      <span class="mf">-75.12420087227511</span> <span class="mf">-354.47822960532113</span> <span class="mf">-1127.973927925715</span>
      <span class="mf">-2316.371054759451</span> <span class="mf">-2772.1795597594755</span> <span class="mf">-1467.4895971641686</span><span class="p">))</span>
   <span class="o">#(</span><span class="s">&quot;residuals&quot;</span> <span class="p">(</span><span class="mf">7.958513839371895e-4</span><span class="p">))</span>
   <span class="o">#(</span><span class="s">&quot;ss-reg&quot;</span> <span class="mf">0.24239162093851477</span><span class="p">)</span>
   <span class="o">#(</span><span class="s">&quot;singular-values&quot;</span>
     <span class="p">(</span><span class="mf">3.128894711145785</span> <span class="mf">1.064548669029962</span> <span class="mf">0.27180324022363517</span>
      <span class="mf">0.05296821542551952</span> <span class="mf">0.008387108325776571</span> <span class="mf">0.0010157565988992792</span>
      <span class="mf">9.583030547029836e-5</span> <span class="mf">7.605115790256685e-6</span>
      <span class="mf">4.6491044714423815e-7</span> <span class="mf">1.9871421381342612e-8</span>
      <span class="mf">6.009222284310632e-10</span><span class="p">))</span>
   <span class="o">#(</span><span class="s">&quot;r-squared&quot;</span> <span class="mf">0.9967274161723995</span><span class="p">)</span>
   <span class="o">#(</span><span class="s">&quot;ss-res&quot;</span> <span class="mf">7.958513853880548e-4</span><span class="p">)</span>
   <span class="o">#(</span><span class="s">&quot;y-mean&quot;</span> <span class="mf">0.8495756097560976</span><span class="p">)</span>
   <span class="o">#(</span><span class="s">&quot;ss-tot&quot;</span> <span class="mf">0.2431874712195122</span><span class="p">)))</span></code></pre></div>

<p>We can also extract only what we need:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">r-squared</span> <span class="p">(</span><span class="nv">py:attr</span> <span class="nv">model</span> <span class="ss">&#39;r-squared</span><span class="p">))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="nv">r-squared</span><span class="p">)</span>
<span class="mf">0.9967274161723995</span></code></pre></div>

<p>When we created our first model, we ran it against several values to see if
the outputs fit our measured data. One of those was the value <code>-9</code> which
returned <code>0.77668860985022548</code>. Let's try that again with our new object:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">lsci-np:-&gt;float</span> <span class="p">(</span><span class="nv">py:method</span> <span class="nv">model</span> <span class="ss">&#39;predict</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">-9</span><span class="p">)))</span>
<span class="mf">0.7766886098502255</span></code></pre></div>

<p>Nice.</p>

<h2 id="plotting-the-model-with-the-observed-data">Plotting the Model with the Observed Data</h2>

<p>We're going to need some data to feed to our fitted-poly function so that it
can create the smooth polynomial curve that we will overlay on our scatter
plot. Let's create a linear space between our minimum and maximum x values
(200 points should give us a nice, smooth curve). Then let's use fitted-poly
to generate the y values:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">xs-fitted</span>
    <span class="p">(</span><span class="nv">lsci-np:linspace</span>
      <span class="p">(</span><span class="nv">py:method</span> <span class="nv">xs</span> <span class="ss">&#39;min</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">py:method</span> <span class="nv">xs</span> <span class="ss">&#39;max</span><span class="p">)</span>
      <span class="o">`</span><span class="p">(</span><span class="o">#(</span><span class="nv">num</span> <span class="mi">200</span><span class="p">))))</span>
<span class="o">#(</span><span class="nv">$erlport.opaque</span> <span class="nv">python</span> <span class="o">...</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">ys-fitted</span>
    <span class="p">(</span><span class="nv">py:method</span> <span class="nv">model</span> <span class="ss">&#39;predict</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">xs-fitted</span><span class="p">)))</span></code></pre></div>

<p>Now we're ready to put them together:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">defun</span> <span class="nv">plot-both</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">lsci-asciiplot:scatter</span> <span class="nv">xs</span> <span class="nv">ys</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">lsci-asciiplot:line</span>
      <span class="nv">xs-fitted</span> <span class="nv">ys-fitted</span>
      <span class="o">&#39;</span><span class="p">(</span><span class="o">#(</span><span class="nv">hold</span> <span class="nv">true</span><span class="p">))))</span>
<span class="nv">plot-both</span></code></pre></div>

<p>When we call our plot function:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">plot-both</span><span class="p">)</span></code></pre></div>

<p>We get the following, which shows the scatter plot of the original data
(<code>o</code> markers) with the polynomial curve fit overlaid (<code>-</code> markers):</p>

<div class="highlight"><pre><code>                                                                           o-----o
                                                                      o o  --    -
                                                                  o  o ----
                                                               ---------
                                                        o o ----
                                          o      o o  o o---
                                        o----------------
                                     oo--
                                    o--o
                                    --
                                 oo--
                                  --
                                 o-
                               o -
                               o-
                               -
                             o -
                              -
                             -
                            --
                           o-
                          o-o
                         o--
                         --
                       o--o
                       --
                     o--
                   oo--
o           o  ooo --
     ooo------------
---------
o-

ok
</code></pre></div>

<h2 id="conclusion">Conclusion</h2>

<p>And there you have it! Fast polynomial curve-fitting from LFE using Python,
NumPy, and SciPy. The work has only just begun on lsci, so if this sort of
thing floats your boat, be sure to take a look at
<a href="https://github.com/lfex/lsci/issues">some of the development tasks</a> and
come give us a hand!</p>

<p>Even though there's a lot to do, there's a lot of reward :-) Every little
function that gets converted
brings enormous satisfaction: the ability to perform these sorts of computing
tasks without having to leave the Erlang ecosystem is a wonderful change. We
hope it's one that you not only get used to, but can't live without :-)</p>

          <hr>
          <div class="pagination btn-group">
            
            <a class="btn prev" href="/announcements/2014/12/27/1641-easy-python-from-lfeerlang" title="Easy Python from LFE/Erlang">&larr; Previous</a>
            
            <a class="btn" href="/archive.html">Archive</a>
            
            <a class="btn next" href="/announcements/2015/01/03/1244-coming-soon-lfe-fridays" title="Coming Soon: LFE Friday!">Next &rarr;</a>
            
          </div>
          <hr>
          
        </div>

        <div class="span4">
          <section>
            <h4>Author</h4>
            <div class="author"><span><a href="/authors.html#Duncan McGreggor">Duncan McGreggor</a></span></div>
          </section>
          <section>
            <h4>Published</h4>
            <div class="date"><span>01 January 2015</span></div>
          </section>
          
          <section>
            <h4>Category</h4>
            <span class="category">
              tutorials
            </span>
          </section>
          
          
          <section>
            <h4>Tags</h4>
            <ul class="tag_box">
              
              


  
     
    	<li><a href="/tags.html#erlang-ref">erlang <span>71</span></a></li>
     
    	<li><a href="/tags.html#python-ref">python <span>4</span></a></li>
     
    	<li><a href="/tags.html#howtos-ref">howtos <span>8</span></a></li>
     
    	<li><a href="/tags.html#libraries-ref">libraries <span>11</span></a></li>
     
    	<li><a href="/tags.html#numpy-ref">numpy <span>1</span></a></li>
     
    	<li><a href="/tags.html#scipy-ref">scipy <span>1</span></a></li>
     
    	<li><a href="/tags.html#erlport-ref">erlport <span>4</span></a></li>
     
    	<li><a href="/tags.html#py-ref">py <span>1</span></a></li>
     
    	<li><a href="/tags.html#ascii-ref">ascii <span>1</span></a></li>
     
    	<li><a href="/tags.html#plotting-ref">plotting <span>1</span></a></li>
     
    	<li><a href="/tags.html#maths-ref">maths <span>1</span></a></li>
     
    	<li><a href="/tags.html#statistics-ref">statistics <span>1</span></a></li>
     
    	<li><a href="/tags.html#science-ref">science <span>1</span></a></li>
     
    	<li><a href="/tags.html#scientific computing-ref">scientific computing <span>1</span></a></li>
     
    	<li><a href="/tags.html#statistical analysis-ref">statistical analysis <span>1</span></a></li>
     
    	<li><a href="/tags.html#linear regression-ref">linear regression <span>1</span></a></li>
     
    	<li><a href="/tags.html#curve fitting-ref">curve fitting <span>1</span></a></li>
     
    	<li><a href="/tags.html#polynomials-ref">polynomials <span>1</span></a></li>
    
  



            </ul>
          </section>
          
        </div>
      </div>


    </div>
  </div> <!-- /container -->
</div>




    <div id="footer" >
    <div class="lower_footer">
      <ul class="footer-cell">
        <li><a href="/archive.html">Archives</a></li>
        <li><a href="/categories.html">Categories</a></li>
        <li><a href="/tags.html">Tags</a></li>
        <li><a href="/authors.html">Authors</a></li>
        <li><a href="/pages.html">Pages</a></li>
      </ul>

      <span class="footer-cell">
        <a href="/"><img src="/assets/themes/lfe/images/logo-white.png"/></a>
      </span>

      <ul class="footer-cell">
        <li><a href="http://github.com/lfex">lfex</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/lisp-flavoured-erlang">List</a></li>
        <li><a href="http://webchat.freenode.net/?channels=erlang-lisp">IRC</a></li>
        <li><a href="http://feeds.feedburner.com/lfe/news-and-updates">RSS</a></li>
        <li><a href="http://twitter.com/ErlangLisp">Twitter</a></li>
        <li><a href="http://github.com/rvirding/lfe">Github</a></li>
      </ul>
    </div>

    <div class="wrapper">
      <p>Original Design &copy; <span class="js-year"></span> GitHub, Inc.</p>
      <p>LFE Design and Content &copy; <span class="js-year"></span> LFEuminati | Alien Alliance</p>
    </div>

  </div><!-- /#footer -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/lfe/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/lfe/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-38274766-2', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>

