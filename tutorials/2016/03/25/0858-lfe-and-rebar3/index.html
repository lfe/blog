

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      LFE Blog
      
         - LFE and rebar3
      
    </title>
    <meta name="description" content="">
    <meta name="author" content="LFEuminati | Alien Alliance">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="/assets/themes/lfe/css/reset.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/assets/themes/lfe/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/lfe/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/css/twilight.css" rel="stylesheet" type="text/css" media="all">

    <link href="/assets/themes/lfe/css/lfetheme.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/lfe/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/assets/css/overrides.css" rel="stylesheet" type="text/css" media="all">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="LFE News & Updates Atom Feed">
  </head>
  <body class="overview">
    <div id="header-wrapper">
      <div id="header">
        <div>
          <a class="logo" href="/">LFE Blog</a>
          <ul class="nav">
            <li><a href="/archive.html" class="nav-api">Archives</a></li>
            <li><a href="/categories.html" class="nav-developers">Categories</a></li>
            <li><a href="/tags.html" class="nav-developers">Tags</a></li>
            <li><a href="/authors.html">Authors</a></li>
            <li class="divider">|</li>
            <li><a href="http://plan.lfe.io/">.plan</a></li>
            <li><a href="http://docs.lfe.io/">docs.lfe.io</a></li>
            <li><a href="http://lfe.io/">lfe.io</a></li>
          </ul>
        </div>
      </div><!-- #header -->
    </div><!-- #header-wrapper -->

    

<div class="wrapper">
  <div class="container">
    <div class="content">
      
      <div class="page-header">
        <h1>
          LFE and rebar3
          
        </h1>
      </div>

      <div class="row">
        <div class="span8">
          
<p><a href="/assets/images/posts/lfe-rebar3-logo.png"><img class="left thumb" src="/assets/images/posts/lfe-rebar3-logo.png" /></a>
This post provides a quick introduction to using <code>rebar3</code> in LFE projects or
in Erlang+LFE projects. After this quick read, you'll be able to jump right in
to LFE development in projects managed with <code>rebar3</code> :-)
<br /> <br /></p>

<p>With the support of namespaces landing in <code>rebar3</code> last year, the LFE
community started making slow but steady progress toward adopting <code>rebar3</code> as
its preferred tool for building projects, running tests, creating releases,
examining dependency trees, generating docs, and creating generally useful,
project-oriented command-line tools.</p>

<p>As a community, we've still got a ways to go before we completely reproduce all
the functionality that has been provided by <code>lfetool</code>, but every new LFE
plugin brings us closer to that goal.</p>

<p>Note that this post assumes that you already have Erlang installed on your
system.</p>

<h2 id="installing-rebar3">Installing <code>rebar3</code></h2>

<p>There are several ways to get <code>rebar3</code> (including building it yourself), but
most of us use the readily available option provided on the project's
<a href="https://github.com/erlang/rebar3">README</a>:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>wget https://s3.amazonaws.com/rebar3/rebar3 <span class="o">&amp;&amp;</span> chmod +x rebar3
<span class="nv">$ </span>sudo mv rebar3 /usr/local/bin</code></pre></div>

<p>This is the nightly build. I have been very happy with the nightlies and have
used them consistently in both development and production without any issues.
If you'd like to read more about installing <code>rebar3</code>, be sure to check out
the <a href="http://www.rebar3.org/docs/getting-started">getting started page</a>.</p>

<h2 id="compiling-lfe-files">Compiling LFE Files</h2>

<p>With <code>rebar3</code> installed, you're ready to rock and roll: bringing LFE into an
Erlang project is as simple as updating your <code>rebar.config</code> file. (Note that
if you are moving from <code>rebar</code> to <code>rebar3</code>, it is indeed a <em>move</em>:
for the most part, <code>rebar3</code> configuration options are not backwards
compatible with <code>rebar</code>).</p>

<p>If you've got an Erlang project and you want to support adding LFE files to it,
here's all you need to do to the project's <code>rebar.config</code>:</p>

<div class="highlight"><pre><code class="language-erlang"><span class="p">{</span><span class="n">plugins</span><span class="p">,</span> <span class="p">[</span>
   <span class="p">{</span><span class="n">&#39;lfe-compile&#39;</span><span class="p">,</span>
     <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;https://github.com/lfe-rebar3/compile.git&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">tag</span><span class="p">,</span> <span class="s">&quot;0.3.0&quot;</span><span class="p">}}}</span>
  <span class="p">]}.</span>

<span class="p">{</span><span class="n">provider_hooks</span><span class="p">,</span> <span class="p">[{</span><span class="n">pre</span><span class="p">,</span> <span class="p">[{</span><span class="n">compile</span><span class="p">,</span> <span class="p">{</span><span class="n">lfe</span><span class="p">,</span> <span class="n">compile</span><span class="p">}}]}]}.</span></code></pre></div>

<p>Then, add <code>.lfe</code> source files to your heart's content. When done, simply
compile:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 compile</code></pre></div>

<p>This will pull down all the dependencies that the LFE-rebar3 plugin has
(including LFE itself), compile all your <code>.erl</code> files that <code>rebar3</code>
normally does, and then compile any <code>.lfe</code> files you have added.</p>

<p>Note that if you only want to (re-)compile <code>.lfe</code> files, you may explicitly
call the plugin's compile command:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 lfe compile</code></pre></div>

<p>If your project is LFE-only (no <code>.erl</code> files), the set up is exactly the
same.</p>

<h2 id="bringing-in-lfe-libraries">Bringing in LFE Libraries</h2>

<p>If you'd like to add some of the <a href="https://github.com/lfex">community LFE
libraries</a> to your project, or pull in libraries from
somewhere else, simply add them to the <code>deps</code> section in the
<code>rebar.config</code>. Here's how you add the LFE library which allows you to use
some Clojure idioms in your LFE code (e.g., the <code>-&gt;</code> and <code>-&gt;&gt;</code> thrushing
macros):</p>

<div class="highlight"><pre><code class="language-erlang"><span class="p">{</span><span class="n">deps</span><span class="p">,</span> <span class="p">[</span>
   <span class="p">{</span><span class="n">clj</span><span class="p">,</span> <span class="s">&quot;.*&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;git://github.com/lfex/clj.git&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">tag</span><span class="p">,</span> <span class="s">&quot;0.4.0&quot;</span><span class="p">}}}</span>
  <span class="p">]}.</span></code></pre></div>

<p>Running <code>rebar3 compile</code> again will pull down this library and all of its
dependencies, making all of their modules and include files available for use
in your LFE code. (Note that if you want to use the thrushing macros, you'll
need to put <code>(include-lib "clj/include/compose.lfe")</code> after your
<code>defmodule</code>.)</p>

<h2 id="lfe-plugins">LFE Plugins</h2>

<p>The LFE compile plugin is written in Erlang. However, all the other LFE-rebar3
plugins currently under development are written in LFE itself. There are a few
<a href="https://github.com/lfe-rebar3">small utility plugins</a> that we've been
experimenting with, but perhaps the most useful plugin right now is the
<a href="https://github.com/lfe-rebar3/lodox">lodox</a> documentation-generator (inspired
by Clojure's <a href="https://github.com/weavejester/codox">Codox</a>).</p>

<p>If you'd like to use this plugin, simply add it to your other <code>rebar3</code>
plugins:</p>

<div class="highlight"><pre><code class="language-erlang"><span class="p">{</span><span class="n">plugins</span><span class="p">,</span> <span class="p">[</span>
   <span class="p">{</span><span class="n">&#39;lfe-compile&#39;</span><span class="p">,</span>
     <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;https://github.com/lfe-rebar3/compile.git&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">tag</span><span class="p">,</span> <span class="s">&quot;0.3.0&quot;</span><span class="p">}}},</span>
   <span class="p">{</span><span class="n">lodox</span><span class="p">,</span>
     <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;https://github.com/lfe-rebar3/lodox.git&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">tag</span><span class="p">,</span> <span class="s">&quot;0.12.10&quot;</span><span class="p">}}}</span>
  <span class="p">]}.</span></code></pre></div>

<p>And then you are ready to use it to generate HTML docs for your LFE source
code:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 lfe lodox</code></pre></div>

<h2 id="rebar3-features"><code>rebar3</code> Features</h2>

<p><code>rebar3</code> is a fantastic tool with a whole suite of incredibly useful
features. If you run the following command:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 --help</code></pre></div>

<p>part of the output will show the standard commands that come with the tool
(many of which also take their own subcommands; try out <code>rebar new --help</code>):</p>

<div class="highlight"><pre><code>as                Higher order provider for running multiple tasks in ...
clean             Remove compiled beam files from apps.
compile           Compile apps .app.src and .erl files.
cover             Perform coverage analysis.
ct                Run Common Tests.
deps              List dependencies
dialyzer          Run the Dialyzer analyzer on the project.
do                Higher order provider for running multiple tasks in ...
edoc              Generate documentation using edoc.
escriptize        Generate escript archive.
eunit             Run EUnit Tests.
help              Display a list of tasks or help for a given task or subtask.
new               Create new project from templates.
path              Print paths to build dirs in current profile.
pkgs              List available packages.
release           Build release of project.
relup             Create relup of releases.
report            Provide a crash report to be sent to the rebar3 issues page.
shell             Run shell with project apps and deps in path.
tar               Tar archive of release built of project.
tree              Print dependency tree.
unlock            Unlock dependencies.
update            Update package index.
upgrade           Upgrade dependencies.
version           Print version for rebar and current Erlang.
xref              Run cross reference analysis.
</code></pre></div>

<p>Note that if you have a bunch of LFE plugins configured for use in your
project, you'll also see those displayed as part of the output of
<code>rebar3 help</code>:</p>

<div class="highlight"><pre><code>lfe &lt;task&gt;:
  clean          The LFE rebar3 clean plugin.
  compile        The LFE rebar3 compiler plugin
  lodox          Generate documentation from LFE source files.
  repl           The LFE rebar3 LFE REPL plugin.
  test           The LFE rebar3 test plugin.
  version        The LFE rebar3 version plugin.
</code></pre></div>

<p>I've found the <code>tree</code> command quite helpful to track down explicit
dependencies and their versions when debugging issues between projects:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 tree</code></pre></div>
<div class="highlight"><pre><code>===&gt; Verifying dependencies...
└─ lsci─0.0.2 (project app)
   ├─ encurses─0.4.1 (git repo)
   └─ py─0.0.5 (git repo)
      ├─ erlport─0.9.8 (git repo)
      ├─ logjam─0.4.0 (git repo)
      â  ├─ color─0.2.0 (git repo)
      â  ├─ lager─3.1.0 (git repo)
      â  â  └─ goldrush─0.1.8 (git repo)
      â  └─ lcfg─ (git repo)
      â     └─ ltest─0.8.0 (git repo)
      └─ lutil─0.8.0 (git repo)
         ├─ clj─0.4.0 (git repo)
         â  └─ kla─0.6.0 (git repo)
         └─ lfe─1.0 (git repo)
</code></pre></div>

<h2 id="profiles">Profiles</h2>

<p>This <code>rebar3</code> feature is important enough for its own section :-) You can
read about <code>rebar3</code> profiles <a href="https://www.rebar3.org/docs/profiles">here</a> but
in short, they allow you to split up potentially very large <code>rebar.config</code>
files into sections that will only get run if a particular profile is active.</p>

<p>Practically speaking, this means that you can do things like the following:</p>

<ul>
  <li>allow your users to only download the minimum dependencies when compiling
your library</li>
  <li>for example, only downloading and compiling the testing framework when
running tests, or</li>
  <li>only downloading doc tools when running the "docs" profile</li>
  <li>providing developer tools only run running the "dev" profile</li>
  <li>set explicit dependencies on a per-profile basis</li>
  <li>avoid some cyclic dependency issues</li>
</ul>

<p>This drastically reduced download and compile times for several of our more
dependency-heavy libraries. <a href="https://github.com/lfex/exemplar/blob/master/rebar.config">Here's an
example</a> of an LFE
project's <code>rebar.config</code> file making good use of the profiles feature. In
that example, you can run the following commands to perform the per-profile
actions:</p>

<p>Run the unit tests:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 as <span class="nb">test </span>eunit</code></pre></div>

<p>Get detailed version info:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 as dev lfe version</code></pre></div>

<p>Build the API reference for the project:</p>

<div class="highlight"><pre><code class="language-bash"><span class="nv">$ </span>rebar3 as docs lfe lodox</code></pre></div>

<p>We've only just started using <code>rebar3</code> profiles in some of the LFE libraries,
but we're already pretty big fans.</p>

<h2 id="community-goals">Community Goals</h2>

<p>Our ultimate goal with rebar3 is to provide a suite of genuinely useful LFE
plugins (written in LFE) that devs adore using. One of the things we've got
slated for up-coming hack time is templates for LFE projects: not only
providing LFE versions of the Erlang ones that ship with <code>rebar3</code> but also
YAWS, elli, and LFE Dragon templates.</p>


          <hr>
          <div class="pagination btn-group">
            
            <a class="btn prev" href="/tutorials/2016/03/05/0407-lfe-v10-exporting-macros" title="Coming in LFE v1.0: exporting macros">&larr; Previous</a>
            
            <a class="btn" href="/archive.html">Archive</a>
            
            <a class="btn next" href="/tutorials/2016/04/27/1647-tracing-lfe-functions" title="Tracing LFE Functions">Next &rarr;</a>
            
          </div>
          <hr>
          
        </div>

        <div class="span4">
          <section>
            <h4>Author</h4>
            <div class="author"><span><a href="/authors.html#Duncan McGreggor">Duncan McGreggor</a></span></div>
          </section>
          <section>
            <h4>Published</h4>
            <div class="date"><span>25 March 2016</span></div>
          </section>
          
          <section>
            <h4>Category</h4>
            <span class="category">
              tutorials
            </span>
          </section>
          
          
          <section>
            <h4>Tags</h4>
            <ul class="tag_box">
              
              


  
     
    	<li><a href="/tags.html#howto-ref">howto <span>2</span></a></li>
     
    	<li><a href="/tags.html#libraries-ref">libraries <span>11</span></a></li>
     
    	<li><a href="/tags.html#tools-ref">tools <span>8</span></a></li>
     
    	<li><a href="/tags.html#utilities-ref">utilities <span>3</span></a></li>
    
  



            </ul>
          </section>
          
        </div>
      </div>


    </div>
  </div> <!-- /container -->
</div>




    <div id="footer" >
    <div class="lower_footer">
      <ul class="footer-cell">
        <li><a href="/archive.html">Archives</a></li>
        <li><a href="/categories.html">Categories</a></li>
        <li><a href="/tags.html">Tags</a></li>
        <li><a href="/authors.html">Authors</a></li>
        <li><a href="/pages.html">Pages</a></li>
      </ul>

      <span class="footer-cell">
        <a href="/"><img src="/assets/themes/lfe/images/logo-white.png"/></a>
      </span>

      <ul class="footer-cell">
        <li><a href="http://github.com/lfex">lfex</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/lisp-flavoured-erlang">List</a></li>
        <li><a href="http://webchat.freenode.net/?channels=erlang-lisp">IRC</a></li>
        <li><a href="http://feeds.feedburner.com/lfe/news-and-updates">RSS</a></li>
        <li><a href="http://twitter.com/ErlangLisp">Twitter</a></li>
        <li><a href="http://github.com/rvirding/lfe">Github</a></li>
      </ul>
    </div>

    <div class="wrapper">
      <p>Original Design &copy; <span class="js-year"></span> GitHub, Inc.</p>
      <p>LFE Design and Content &copy; <span class="js-year"></span> LFEuminati | Alien Alliance</p>
    </div>

  </div><!-- /#footer -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/lfe/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/lfe/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-38274766-2', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>

