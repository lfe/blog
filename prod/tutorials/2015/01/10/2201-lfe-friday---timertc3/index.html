

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      
        LFE Friday - timer:tc/3 -
      
      LFE Tutorials, News, &amp; Updates
    </title>
    <meta name="description" content="">
    <meta name="author" content="LFElluminati | Alien Alliance">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/themes/hooligan/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/hooligan/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/css/twilight.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/css/overrides.css" rel="stylesheet" type="text/css" media="all">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="LFE News & Updates Atom Feed">
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="apple-touch-icon" href="assets/images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="assets/images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="assets/images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>
    <div id="page-wrap">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>

	    <a class="brand" href="/"><img style="float: left; padding-right: 8px;" src="/assets/images/LispFlavoredErlang-xtinsy.png" /> LFE Tutorials, News, &amp; Updates</a>

            <div class="nav-collapse">
              <ul class="nav">
                
                
                


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  



		<li><a href="http://docs.lfe.io/">Docs</a></li>
		<li><a href="http://lfe.io/">lfe.io</a></li>
              </ul>
              <ul class="nav pull-right social visible-desktop">
                <li class="divider-vertical"></li>
                
                <li>
                  <a href="http://webchat.freenode.net/?channels=erlang-lisp" style="color: #999; font-size: 180%; margin-top: 3px;" target="_blank">
                    <span class=""> #</span>
                  </a>
                </li>
                
                
                <li>
                  <a href="https://github.com/lfe" class="zocial github icon" target="_blank">
                    <span class="hidden-desktop">Github</span>
                  </a>
                </li>
                
                
                <li>
                  <a href="https://plus.google.com/u/1/communities/103919485468949397234" class="zocial googleplus icon" target="_blank">
                    <span class="hidden-desktop">Google+</span>
                  </a>
                </li>
                
                
                <li>
                  <a href="https://twitter.com/ErlangLisp" class="zocial twitter icon" target="_blank">
                    <span class="hidden-desktop">Twitter</span>
                  </a>
                </li>
                
                
                
                
                <li>
                  <a href="http://feeds.feedburner.com/lfe/news-and-updates" class="zocial rss icon" target="_blank">
                    <span class="hidden-desktop">FeedBurner</span>
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="content">
          

<div class="page-header">
  <h1>
    LFE Friday - timer:tc/3 
    
  </h1>
</div>

<div class="row">
  <div class="span8">
    
<p><a href="/assets/images/posts/LispFlavoredErlang-medium-square.png"><img class="left tiny" src="/assets/images/posts/LispFlavoredErlang-medium-square.png" /></a>This week’s LFE Friday was translated with permission from the
<a href="http://www.proctor-it.com/category/erlang/erlang-thursday/">Erlang Thursday</a>
series by <a href="https://twitter.com/stevenproctor">Steven Proctor</a>.
<em>This week’s translator</em>: Robert Virding.</p>

<p>Today’s LFE Friday is on <a href="http://www.erlang.org/doc/man/timer.html#tc-3">timer:tc/3</a>.</p>

<p>I am sure we have all written some timing code where we capture the current time, do something, capture the current time again and then find the difference to find out how long something took to execute. In Erlang, that generally looks something like the following:</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">time1</span> <span class="p">(</span><span class="nv">now</span><span class="p">))</span>
<span class="o">#(</span><span class="mi">1420</span> <span class="mi">910649</span> <span class="mi">803027</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">timer:sleep</span> <span class="mi">4000</span><span class="p">)</span>    <span class="c1">;Do something</span>
<span class="nv">ok</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nb">set</span> <span class="nv">time2</span> <span class="p">(</span><span class="nv">now</span><span class="p">))</span>
<span class="o">#(</span><span class="mi">1420</span> <span class="mi">910653</span> <span class="mi">804244</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">timer:now_diff</span> <span class="nv">time2</span> <span class="nv">time1</span><span class="p">)</span>                                             
<span class="mi">4001217</span></code></pre></div>

<p>Note that we have to use <a href="http://www.erlang.org/doc/man/timer.html#now_diff-2">timer:now_diff/2</a>, since the <code>now/0</code> function returns the timestamp as a tuple, and we can’t just do normal subtraction on that tuple like we might be able to in other languages.</p>

<p>Of course as good “engineers”, we know that since we need to do timings in various places of the app we can just create our own function to do that, and have that live in just one place.</p>

<p>The downside is: the wise people on the Erlang language team have done that for us already and provided it in the form of <code>timer:tc/3</code>.</p>

<p><code>timer:tc/3</code> takes the module name, function name, and a list of the arguments to be passed to the function. And since we usually want the result of the function we are calling, in addition to the timing, the return value is a tuple of the time in microseconds, and the result of applying the function passed to <code>timer:tc/3</code>.</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">timer:tc</span> <span class="ss">&#39;timer</span> <span class="ss">&#39;sleep</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">4000</span><span class="p">))</span>
<span class="o">#(</span><span class="mi">4000480</span> <span class="nv">ok</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">timer:tc</span> <span class="ss">&#39;lists</span> <span class="ss">&#39;foldl</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">accum</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">accum</span><span class="p">))</span> <span class="mi">0</span> <span class="p">(</span><span class="nv">lists:seq</span> <span class="mi">1</span> <span class="mi">2000000</span><span class="p">)))</span>
<span class="o">#(</span><span class="mi">3533603</span> <span class="mi">2000001000000</span><span class="p">)</span></code></pre></div>

<p>There is also <code>timer:tc/1</code> which takes just a function and applies it, and <code>timer:tc/2</code> which takes a function and applies it with the given arguments.</p>

<div class="highlight"><pre><code class="language-cl"><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">timer:tc</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">lists:foldl</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">accum</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">accum</span><span class="p">))</span> <span class="mi">0</span> <span class="p">(</span><span class="nv">lists:seq</span> <span class="mi">1</span> <span class="mi">2000000</span><span class="p">))))</span>       
<span class="o">#(</span><span class="mi">3693260</span> <span class="mi">2000001000000</span><span class="p">)</span>
<span class="nb">&gt;</span> <span class="p">(</span><span class="nv">timer:tc</span> <span class="nf">#&#39;</span><span class="nv">lists:foldl/3</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">accum</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">accum</span><span class="p">))</span> <span class="mi">0</span> <span class="p">(</span><span class="nv">lists:seq</span> <span class="mi">1</span> <span class="mi">2000000</span><span class="p">)))</span>
<span class="o">#(</span><span class="mi">3529578</span> <span class="mi">2000001000000</span><span class="p">)</span></code></pre></div>

<p>–Proctor, Robert</p>

    <hr>
    <div class="pagination btn-group">
      
        <a class="btn prev" href="/announcements/2015/01/09/1008-lfetool-150-preview-overriding-version-pinning" title="lfetool 1.5.0 Preview: Overriding Version Pinning">&larr; Previous</a>
      
        <a class="btn" href="/archive.html">Archive</a>
      
        <a class="btn next" href="/tutorials/2015/01/16/2253-lfe-friday---erlangapply3" title="LFE Friday - erlang:apply/3">Next &rarr;</a>
      
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <section>
      <h4>Author</h4>
      <div class="author"><span>Robert Virding</span></div>
    </section>
    <section>
      <h4>Published</h4>
      <div class="date"><span>10 January 2015</span></div>
    </section>
    
      <section>
        <h4>Category</h4>
        <span class="category">
          tutorials
        </span>
      </section>
         
    
      <section>
        <h4>Tags</h4>
        <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags.html#lfe friday-ref">lfe friday <span>5</span></a></li>
     
    	<li><a href="/tags.html#lfe-ref">lfe <span>6</span></a></li>
     
    	<li><a href="/tags.html#erlang-ref">erlang <span>8</span></a></li>
    
  



        </ul>
      </section>
             
  </div>
</div>


        </div>
      </div> <!-- /container -->

      <div class="footer-push"></div>
    </div><!--/.page-wrap -->

    <footer>
      <div class="container">
        <p>&copy; 2015 LFElluminati | Alien Alliance
        </p>
      </div>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/hooligan/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/hooligan/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-38274766-2', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>

